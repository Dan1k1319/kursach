{% extends "main.html" %}

{% block title %}Администрирование отделов - HR Management System{% endblock %}

{% block content %}
<div class="container mt-5">
    <h2 class="mb-4">Администрирование отделов</h2>
    <form method="POST" action="{{ url_for('admin_departments') }}">
        {{ form.hidden_tag() }}
        <div class="form-group">
            <label for="name">Название отдела</label>
            {{ form.name(class="form-control", id="name") }}
        </div>
        <div class="form-group">
            <label for="description">Описание</label>
            {{ form.description(class="form-control", id="description") }}
        </div>
        <button type="submit" class="btn btn-primary">Добавить отдел</button>
    </form>

    <h2 class="mb-4 mt-5">Список отделов</h2>
    <ul class="list-group">
        {% for department in departments %}
            <li class="list-group-item mb-4">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h5>{{ department.name }}</h5>
                        <p>{{ department.description }}</p>
                        <p>Менеджер: {{ department.manager.username if department.manager else 'Не назначен' }}</p>
                    </div>
                    <div>
                        <a href="{{ url_for('edit_department', department_id=department.id) }}" class="btn btn-secondary btn-sm">Редактировать</a>
                    </div>
                </div>
                <hr>
                <h6>Участники отдела:</h6>
                <ul class="list-group">
                    {% for user in department.members %}
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <a href="{{ url_for('profile', user_id=user.id) }}">{{ user.username }}</a>
                            </div>
                        </li>
                    {% endfor %}
                </ul>
                <form method="POST" action="{{ url_for('assign_user_to_department', department_id=department.id) }}">
                    <div class="form-group mt-3">
                        <label for="user">Добавить пользователя в отдел</label>
                        <select class="form-control" id="user" name="user">
                            {% for user in all_users %}
                            <option value="{{ user.id }}">{{ user.username }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary btn-sm">Добавить</button>
                </form>
            </li>
        {% endfor %}
    </ul>
</div>
{% endblock %}